"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7638],{97638:(e,t,r)=>{r.d(t,{InventoryProvider:()=>p,o:()=>u});var o=r(95155),i=r(12115),n=r(33168),d=r(58012);let a=(0,i.createContext)(void 0),l=[{id:"1",itemType:"Toner",tonerModel:"HP 85A",quantity:20,supplier:"Tech Supplies Ltd",receivedDate:"2024-01-15",notes:"Bulk order for Q1"},{id:"2",itemType:"Keyboard",quantity:10,supplier:"Office Depot",receivedDate:"2024-01-20",notes:"Wireless keyboards"}],s=[{id:"1",itemType:"Toner",tonerModel:"HP 85A",quantity:2,issuedTo:"John Doe",issuedDate:"2024-01-25",notes:"For office printer"}],c=[{id:"1",model:"HP 85A",currentStock:18,lowStockThreshold:5,lastUpdated:"2024-01-25"},{id:"2",model:"HP 87A",currentStock:12,lowStockThreshold:5,lastUpdated:"2024-01-20"},{id:"3",model:"Canon 303",currentStock:8,lowStockThreshold:5,lastUpdated:"2024-01-18"}];function p(e){let{children:t}=e,[r,p]=(0,i.useState)(l),[u,m]=(0,i.useState)(s),[y,_]=(0,i.useState)(c),[w,f]=(0,i.useState)(!0),[T,h]=(0,i.useState)(null),[v,g]=(0,i.useState)(!0),{devices:S}=(0,d.t)(),k=async()=>{if(f(!0),h(null),!(0,n.$G)()){g(!0),f(!1);return}try{let e=(0,n.Sw)(),{data:t,error:r}=await e.from("received_items").select("*").order("received_date",{ascending:!1});if(r&&"PGRST116"!==r.code)throw r;let{data:o,error:i}=await e.from("issued_items").select("*").order("issued_date",{ascending:!1});if(i&&"PGRST116"!==i.code)throw i;let{data:d,error:a}=await e.from("toner_stock").select("*");if(a&&"PGRST116"!==a.code)throw a;t&&p(t.map(e=>({id:e.id,itemType:e.item_type,tonerModel:e.toner_model,tonerColor:e.toner_color,tonerType:e.toner_type,printerId:e.printer_id||void 0,printerName:e.printer_name||void 0,quantity:e.quantity,supplier:e.supplier,receivedDate:e.received_date,notes:e.notes||void 0,createdAt:e.created_at}))),o&&m(o.map(e=>({id:e.id,itemType:e.item_type,tonerModel:e.toner_model,tonerColor:e.toner_color,tonerType:e.toner_type,printerId:e.printer_id||void 0,printerName:e.printer_name||void 0,quantity:e.quantity,issuedTo:e.issued_to,issuedDate:e.issued_date,assetId:e.asset_id||void 0,notes:e.notes||void 0,createdAt:e.created_at}))),d&&_(d.map(e=>({id:e.id,model:e.model,color:e.color,printerId:e.printer_id||void 0,printerName:e.printer_name||void 0,currentStock:e.current_stock,lowStockThreshold:e.low_stock_threshold,lastUpdated:e.last_updated}))),g(!1)}catch(e){console.error("Error fetching inventory:",e),h(e.message||"Failed to fetch inventory data"),g(!0)}finally{f(!1)}};(0,i.useEffect)(()=>{k()},[]);let I=async e=>{let t={...e,id:Date.now().toString()};if(p(e=>[t,...e]),"Toner"===e.itemType&&e.tonerModel&&e.printerId&&await A(e.tonerModel,e.quantity,e.tonerColor,e.printerId),(0,n.$G)()&&!v)try{let t=(0,n.Sw)(),{error:r}=await t.from("received_items").insert({item_type:e.itemType,toner_model:e.tonerModel||null,toner_color:e.tonerColor||null,toner_type:e.tonerType||null,printer_id:e.printerId||null,printer_name:e.printerName||null,quantity:e.quantity,supplier:e.supplier,received_date:e.receivedDate,notes:e.notes||null});if(r)throw r;await k()}catch(e){console.error("Error adding received item:",e),h(e.message||"Failed to add received item")}},q=async e=>{let t={...e,id:Date.now().toString()};if(m(e=>[t,...e]),"Toner"===e.itemType&&e.tonerModel&&e.printerId){let t=G(e.tonerModel,e.tonerColor,e.printerId);t&&t.currentStock>0?await A(e.tonerModel,-e.quantity,e.tonerColor,e.printerId):console.warn("No stock found for ".concat(e.tonerModel," ").concat(e.tonerColor||""," for printer ").concat(e.printerId))}if((0,n.$G)()&&!v)try{let t=(0,n.Sw)(),{error:r}=await t.from("issued_items").insert({item_type:e.itemType,toner_model:e.tonerModel||null,toner_color:e.tonerColor||null,toner_type:e.tonerType||null,printer_id:e.printerId||null,printer_name:e.printerName||null,quantity:e.quantity,issued_to:e.issuedTo,issued_date:e.issuedDate,asset_id:e.assetId||null,notes:e.notes||null});if(r)throw r;await k()}catch(e){console.error("Error adding issued item:",e),h(e.message||"Failed to add issued item")}},N=async(e,t)=>{if(p(r=>r.map(r=>r.id===e?{...r,...t}:r)),(0,n.$G)()&&!v)try{let r=(0,n.Sw)(),{error:o}=await r.from("received_items").update({item_type:t.itemType||void 0,toner_model:t.tonerModel||null,toner_color:t.tonerColor||null,toner_type:t.tonerType||null,printer_id:t.printerId||null,printer_name:t.printerName||null,quantity:t.quantity||void 0,supplier:t.supplier||void 0,received_date:t.receivedDate||void 0,notes:t.notes||null}).eq("id",e);if(o)throw o;await k()}catch(e){console.error("Error updating received item:",e),h(e.message||"Failed to update received item")}},C=async(e,t)=>{if(m(r=>r.map(r=>r.id===e?{...r,...t}:r)),(0,n.$G)()&&!v)try{let r=(0,n.Sw)(),{error:o}=await r.from("issued_items").update({item_type:t.itemType||void 0,toner_model:t.tonerModel||null,toner_color:t.tonerColor||null,toner_type:t.tonerType||null,printer_id:t.printerId||null,printer_name:t.printerName||null,quantity:t.quantity||void 0,issued_to:t.issuedTo||void 0,issued_date:t.issuedDate||void 0,asset_id:t.assetId||null,notes:t.notes||null}).eq("id",e);if(o)throw o;await k()}catch(e){console.error("Error updating issued item:",e),h(e.message||"Failed to update issued item")}},M=async e=>{let t=r.find(t=>t.id===e);if(t&&"Toner"===t.itemType&&t.tonerModel&&t.printerId&&await A(t.tonerModel,-t.quantity,t.tonerColor,t.printerId),p(t=>t.filter(t=>t.id!==e)),(0,n.$G)()&&!v)try{let t=(0,n.Sw)(),{error:r}=await t.from("received_items").delete().eq("id",e);if(r)throw r;await k()}catch(e){console.error("Error deleting received item:",e),h(e.message||"Failed to delete received item")}},D=async e=>{let t=u.find(t=>t.id===e);if(t&&"Toner"===t.itemType&&t.tonerModel&&t.printerId&&await A(t.tonerModel,t.quantity,t.tonerColor,t.printerId),m(t=>t.filter(t=>t.id!==e)),(0,n.$G)()&&!v)try{let t=(0,n.Sw)(),{error:r}=await t.from("issued_items").delete().eq("id",e);if(r)throw r;await k()}catch(e){console.error("Error deleting issued item:",e),h(e.message||"Failed to delete issued item")}},b=async e=>{if(_(t=>t.filter(t=>t.id!==e)),(0,n.$G)()&&!v)try{let t=(0,n.Sw)(),{error:r}=await t.from("toner_stock").delete().eq("id",e);if(r)throw r;await k()}catch(e){console.error("Error deleting toner stock:",e),h(e.message||"Failed to delete toner stock")}},E=async(e,t)=>{let r=y.find(t=>t.id===e);if(r){if(_(r=>r.map(r=>r.id===e?{...r,...t}:r)),!(0,n.$G)()||v)return;try{let o=(0,n.Sw)(),i=r.printerName;if(void 0!==t.printerId){let e=S.find(e=>e.id===t.printerId);i=e?"".concat(e.assetNumber||e.serialNumber," - ").concat(e.assignedTo||"Unassigned").concat(e.modelNumber?" (".concat(e.modelNumber,")"):""):null}let{error:d}=await o.from("toner_stock").update({model:t.model||void 0,color:t.color||null,printer_id:t.printerId||null,printer_name:i||null,current_stock:void 0!==t.currentStock?t.currentStock:void 0,low_stock_threshold:void 0!==t.lowStockThreshold?t.lowStockThreshold:void 0,last_updated:new Date().toISOString().split("T")[0]}).eq("id",e);if(d)throw d;await k()}catch(t){console.error("Error updating toner stock entry:",t),h(t.message||"Failed to update toner stock entry"),_(t=>t.map(t=>t.id===e?r:t))}}},A=async(e,t,r,o)=>{let i="string"==typeof e?e.trim():e,d=G(i,r,o),a=d?d.currentStock+t:t>0?t:0,l=o?S.find(e=>e.id===o):void 0,s={id:(null==d?void 0:d.id)||Date.now().toString(),model:i,color:r,printerId:o,printerName:l?"".concat(l.assetNumber||l.serialNumber," - ").concat(l.assignedTo||"Unassigned").concat(l.modelNumber?" (".concat(l.modelNumber,")"):""):void 0,currentStock:Math.max(0,a),lowStockThreshold:(null==d?void 0:d.lowStockThreshold)||5,lastUpdated:new Date().toISOString().split("T")[0]};if(_(e=>[...e.filter(e=>e.model.toLowerCase()!==i.toLowerCase()||!!r&&e.color!==r||!r&&!!e.color||!!o&&e.printerId!==o||!!o&&!e.printerId||!o&&!!e.printerId||!1),s]),(0,n.$G)()&&!v)try{let e=(0,n.Sw)(),{error:t}=await e.from("toner_stock").upsert({model:i,color:r||null,printer_id:o||null,printer_name:s.printerName||null,current_stock:Math.max(0,a),low_stock_threshold:(null==d?void 0:d.lowStockThreshold)||5,last_updated:s.lastUpdated},{onConflict:"model,color,printer_id"});if(t)throw t;await k()}catch(e){console.error("Error updating toner stock:",e),h(e.message||"Failed to update toner stock")}},G=(e,t,r)=>{let o="string"==typeof e?e.trim():e;return y.find(e=>e.model.toLowerCase()===o.toLowerCase()&&(!t||e.color===t)&&(!t||!!e.color)&&(!r||e.printerId===r)&&(!r||!!e.printerId)&&(!!r||!e.printerId)&&!0)};return(0,o.jsx)(a.Provider,{value:{receivedItems:r,issuedItems:u,tonerStock:y,loading:w,error:T,isUsingMockData:v,addReceivedItem:I,addIssuedItem:q,updateReceivedItem:N,updateIssuedItem:C,deleteReceivedItem:M,deleteIssuedItem:D,deleteTonerStock:b,updateTonerStock:A,updateTonerStockEntry:E,getTonerStockByModel:G,getLowStockToners:()=>y.filter(e=>e.currentStock<=e.lowStockThreshold),getEligibleUsersForItem:e=>"Keyboard"===e||"Mouse"===e?Array.from(new Set(S.filter(e=>("Computer"===e.type||"Laptop"===e.type)&&e.assignedTo&&"Not Assigned"!==e.assignedTo).map(e=>e.assignedTo))):"Toner"===e?Array.from(new Set(S.filter(e=>"Printer"===e.type&&e.assignedTo&&"Not Assigned"!==e.assignedTo).map(e=>e.assignedTo))):"Monitor"===e?Array.from(new Set(S.filter(e=>"Computer"===e.type&&e.assignedTo&&"Not Assigned"!==e.assignedTo).map(e=>e.assignedTo))):Array.from(new Set(S.filter(e=>e.assignedTo&&"Not Assigned"!==e.assignedTo).map(e=>e.assignedTo))),getPrinters:()=>S.filter(e=>"Printer"===e.type),refreshInventory:k},children:t})}function u(){let e=(0,i.useContext)(a);if(void 0===e)throw Error("useInventory must be used within an InventoryProvider");return e}}}]);